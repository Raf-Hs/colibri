name: k6 Load Test

on:
  pull_request:
    branches:
      - main
      - development

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    #  NUEVO PASO: Instalar k6
    - name: Install k6
      uses: grafana/k6-action@v0.1.0 
      # Esta acci贸n simplemente instala k6 y lo a帽ade al PATH.

    - name: Run k6 load test
      # 锔 CAMBIO IMPORTANTE: Usaremos la misma acci贸n, pero con la ruta del script ajustada.
      # La acci贸n 'grafana/run-k6-action' es antigua; usaremos 'k6-action' para instalar y ejecutar.
      uses: grafana/k6-action@v0.1.0 # Usamos la misma acci贸n de instalaci贸n/ejecuci贸n
      with:
        # La ruta que est谩s usando (asumiendo que es correcta despu茅s del checkout):
        script: test/load-test.js
        # El token de Cloud se sigue pasando por env para subir los resultados.

      env:
        K6_CLOUD_TOKEN: ${{ secrets.GRAFANA_CLOUD_K6_TOKEN_DIEGO }}
        # Tambi茅n puedes a帽adir la flag de Cloud aqu铆, aunque el token deber铆a ser suficiente
        # K6_CLOUD_OUTPUT: true
