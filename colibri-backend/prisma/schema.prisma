// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TripStatus {
  PENDIENTE
  EN_CURSO
  FINALIZADO
  CANCELADO
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nombre    String
  email     String   @unique
  telefono  String
  password  String
  rol       String   @default("viajero")

  sexo      String   @default("hombre")   // ← AGREGAR ESTO

  secret2FA String?
  createdAt DateTime @default(now())
  viajes    Viaje[]  @relation("UsuarioViajes")

  identificacion   String?
  licencia         String?
  poliza           String?
  domicilio        String?
  fotoConductor    String?
  vehiculoFotos    String[] @default([])
  acreditacionTaxi String?
  estadoValidacion String   @default("pendiente")
  wallet           Float    @default(0)

  reviewsHechas    Review[] @relation("AutorReview")
  reviewsRecibidas Review[] @relation("DestinoReview")
}

model Viaje {
  id           Int        @id @default(autoincrement())
  origen       String
  destino      String
  costo        Int
  metodoPago   String
  estado       TripStatus @default(PENDIENTE)
  calificacion Int?
  conductor    String
  usuarioId    Int

  usuario   Usuario  @relation("UsuarioViajes", fields: [usuarioId], references: [id])
  createdAt DateTime @default(now())
}

model Historial {
  id           Int      @id @default(autoincrement())
  pasajero     String
  conductor    String
  origen       Json
  destino      Json
  distancia    String
  duracion     String
  costo        String
  estado       String   @default("finalizado")
  fecha        DateTime @default(now())
  origenTexto  String?
  destinoTexto String?

  // Relación inversa con Review
  reviews Review[]
}

model Review {
  id         Int     @id @default(autoincrement())
  autorId    Int
  destinoId  Int
  viajeId    Int
  rating     Int
  comentario String?

  autor   Usuario   @relation("AutorReview", fields: [autorId], references: [id])
  destino Usuario   @relation("DestinoReview", fields: [destinoId], references: [id])
  viaje   Historial @relation(fields: [viajeId], references: [id])

  createdAt DateTime @default(now())
}
